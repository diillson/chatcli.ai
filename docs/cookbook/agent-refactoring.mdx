---
title: "Receita: Refatora√ß√£o Segura com Modo Agente"
sidebarTitle: "Refatora√ß√£o com Agente"
description: "Use o poder do Modo Agente para planejar e executar uma refatora√ß√£o de c√≥digo passo a passo, com seguran√ßa e controle total."
---


Refatorar c√≥digo, como renomear uma vari√°vel importante em m√∫ltiplos arquivos, pode ser arriscado. Um erro pode quebrar a aplica√ß√£o. Esta receita mostra como delegar essa tarefa ao **Modo Agente**, usando seu poder de planejamento e execu√ß√£o controlada para realizar a refatora√ß√£o com seguran√ßa.

### O Problema

Voc√™ precisa renomear uma vari√°vel de configura√ß√£o, por exemplo, de `DATABASE_URL` para `POSTGRES_DSN`, em todo o seu projeto. Fazer isso manualmente √© tedioso e propenso a erros. Usar `sed` ou `find-and-replace` em massa pode ser perigoso se o nome da vari√°vel for uma substring comum.

### Ingredientes

-   Um projeto de c√≥digo onde voc√™ precisa realizar a refatora√ß√£o.
-   O ChatCLI no modo interativo.

---

### Passo a Passo

#### Passo 1: Delegue a Tarefa ao Agente

Inicie o Modo Agente com uma instru√ß√£o clara e detalhada. Seja espec√≠fico sobre o que precisa ser feito.

```bash
/agent em todo o projeto, encontre todos os arquivos que cont√™m a string "DATABASE_URL" e a substitua por "POSTGRES_DSN". Mostre-me os arquivos que ser√£o modificados antes de fazer qualquer altera√ß√£o.
```

**Desconstruindo o Prompt:**
-   **"em todo o projeto..."**: Define o escopo da opera√ß√£o.
-   **"encontre... e substitua..."**: Descreve a a√ß√£o de refatora√ß√£o.
-   **"Mostre-me os arquivos... antes de fazer qualquer altera√ß√£o"**: Esta √© uma instru√ß√£o de seguran√ßa crucial. Estamos pedindo ao agente para criar um plano que nos permita validar o escopo antes de executar a mudan√ßa.

---

#### Passo 2: Revise o Plano de A√ß√£o

A IA ir√° analisar sua solicita√ß√£o e propor um plano. Um bom plano para esta tarefa provavelmente ter√° duas etapas:

```plaintext
üìã PLANO (vis√£o compacta)
  ‚è≥ #1: Listar arquivos afetados ‚Äî grep -rl "DATABASE_URL" .
  ‚è≥ #2: Executar a substitui√ß√£o ‚Äî find . -type f -name "*" -exec sed -i 's/DATABASE_URL/POSTGRES_DSN/g' {} +
```
<Callout type="warning">
Ponto de Aten√ß√£o: O comando  sed -i  modifica arquivos no local. Embora o plano seja l√≥gico, a segunda etapa √© destrutiva. √â aqui que o controle do Modo Agente se torna vital.
</Callout>

--------

#### Passo 3: Execute e Valide o Primeiro Passo

Em vez de executar tudo de uma vez, vamos executar apenas o primeiro comando para validar o escopo.

No prompt do agente, digite  1  e pressione Enter.

‚û§ Sua escolha: 1

###### O ChatCLI executar√°  grep -rl "DATABASE_URL" .  e mostrar√° a lista de arquivos que cont√™m a string.

Exemplo de Sa√≠da:
```plaintext
üßæ √öLTIMO RESULTADO
  ./config/app.go
  ./internal/database/connection.go
  ./docker-compose.yml
```
> Agora voc√™ pode revisar esta lista. Se ela contiver um arquivo inesperado (ex:  README.md ), voc√™ sabe que a abordagem precisa ser refinada.

--------

#### Passo 4: Edite o Plano para Maior Seguran√ßa (Opcional, mas recomendado)

O comando  sed  √© poderoso, mas pode ser arriscado. Vamos editar o comando 2 para usar uma extens√£o de backup, criando c√≥pias dos arquivos originais.

No prompt do agente, digite  `e2`  (editar comando 2). O ChatCLI pedir√° o novo comando.
```plaintext
Comando 2/2 (shell): find . -type f -name "*" -exec sed -i'.bak' 's/DATABASE_URL/POSTGRES_DSN/g' {} +
```

Agora, o comando  sed  criar√° um arquivo  .bak  para cada arquivo modificado, permitindo uma revers√£o f√°cil se algo der errado.

--------

#### Passo 5: Execute a Refatora√ß√£o e Conclua

Com o plano validado e aprimorado, execute o segundo comando digitando  2 .

O agente executar√° a substitui√ß√£o. Ap√≥s a conclus√£o, voc√™ pode verificar as mudan√ßas com  git diff  e, se tudo estiver correto, remover os arquivos de backup. Voc√™ pode at√© mesmo pedir ao agente para fazer isso:

‚û§ Sua escolha: c2  (Continuar ap√≥s a execu√ß√£o do passo 2)

> A refatora√ß√£o foi conclu√≠da com sucesso. Agora, por favor, crie um comando para encontrar e remover todos os arquivos .bak no projeto.

<Callout type="success">
Resultado: Voc√™ realizou uma refatora√ß√£o em toda a base de c√≥digo de forma interativa e segura. O Modo Agente atuou como um par programador, permitindo que voc√™ validasse cada etapa cr√≠tica antes da execu√ß√£o.
</Callout>


---